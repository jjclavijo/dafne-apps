<head>
    <script src="jquery.min.js"></script>
    <script src="leaflet.js"></script>
    <script src="api.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/0.7.3/leaflet.css" />
  <style>
    #main_map {
      height:100%;
    }
  </style> 
</head>
<body>
  <div id="main_map"></div>
<script text="text/javascript">
var map = L.map('main_map');
L.tileLayer(
  "https://a.tile.opentopomap.org/{z}/{x}/{y}.png",
  {maxZoom:10, attribution: '<a href="https://github.com/jwass/mplleaflet">mplleaflet</a> | <a href="https://opentopomap.org/">© Open Topo Map (CC-By-SA)</a> | <a href=https://www.openstreetmap.org/about">© OpenStreetMap</a>'}).addTo(map);

var vectorlayers = [];

var plotMap = function( gjResponse )
  {
// var gjResponse = $.getJSON({'url':"./fullout.json",'async':false});
  var gjData = gjResponse // JSON.parse(gjResponse.responseText); 

  if (gjData.features.length != 0) {
    var gj = L.geoJson(gjData, {
      style: function (feature) {
        return feature.properties;
      },
      pointToLayer: function (feature, latlng) {
        var icon = L.divIcon({'html': feature.properties.html, 
          iconAnchor: [feature.properties.anchor_x, 
                       feature.properties.anchor_y], 
            className: 'empty'});  // What can I do about empty?
        return L.marker(latlng, {icon: icon});
      }
    });

    if (vectorlayers.length != 0) {
      map.removeLayer(vectorlayers[0]);

      vectorlayers.length = 0;
      }

    gj.addTo(map);
    
    map.fitBounds(gj.getBounds());

    vectorlayers.push(gj); // return layer so we can delete it after

    } else {
      map.setView([0, 0], 1);
    }
  }

var doNothing = function( error ) { alert(error) }

let searchParams = new URLSearchParams(window.location.search)

if ( searchParams.has('event') ) {
    let ev = searchParams.get('event');
    if ( searchParams.has('dist') ) {
        let di = search.Params.get('dist');
        getMapByEventByDist(ev,di,plotMap,doNothing);
      }
    else {
        getMapByEventByDist(ev,2000000,plotMap,doNothing);
      }

  }

</script>

</body>
